<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ù†Ø¯Ù„Ø³ Ù„Ù„ØªÙ‚Ø³ÙŠØ· ğŸ‘¨ğŸ»â€ğŸ’»</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', Tahoma, sans-serif;
      background-color: #f2f4f8;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }

    body.dark-mode {
      background-color: #1e1e2f;
      color: #eee;
    }

    .container {
      max-width: 1000px;
      margin: 40px auto;
      background-color: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    body.dark-mode .container {
      background-color: #2a2a3d;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .btn {
      background-color: #6c757d;
      color: #fff;
      padding: 8px 14px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1;
      min-width: 180px;
    }

    label {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 5px;
      display: block;
    }

    input, select {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .tables {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      text-align: center;
      background-color: #fff;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }

    th {
      background-color: #f1f1f1;
    }

    body.dark-mode table {
      background-color: #3a3a50;
      color: #fff;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      top: 0; right: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.5s ease;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 320px;
      position: relative;
      animation: slideIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; } to { opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .close-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ff4d4d;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
    }

    .export-btn {
      background-color: #28a745;
      color: white;
      padding: 10px 14px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      margin-top: 20px;
    }

    h2 {
      text-align: center;
      color: #007bff;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="top-bar">
    <button class="btn" onclick="openSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <div>
      <button class="btn" onclick="toggleDarkMode()">ğŸŒ“ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
      <button class="btn" onclick="exportPDF()">ğŸ–¨ï¸ ØªØµØ¯ÙŠØ± PDF</button>
    </div>
  </div>

  <h2>Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ù†Ø¯Ù„Ø³ Ù„Ù„ØªÙ‚Ø³ÙŠØ· ğŸ‘¨ğŸ»â€ğŸ’»</h2>

  <div class="form-row">
    <div class="form-group">
      <label>Ø§Ù„ÙØ¦Ø©:</label>
      <select id="category"></select>
    </div>
    <div class="form-group">
      <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
      <input type="number" id="amount">
    </div>
    <div class="form-group">
      <label>Ø§Ù„Ù…Ù‚Ø¯Ù…:</label>
      <input type="number" id="downPayment">
    </div>
    <div class="form-group">
      <label>&nbsp;</label>
      <button class="btn" onclick="calculate()">Ø§Ø­Ø³Ø¨</button>
    </div>
  </div>

  <div class="tables" id="results"></div>
</div>

<div class="modal" id="settingsModal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeSettings()">Ã—</button>
    <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
    <div id="settingsContent"></div>
    <hr>
    <label>â• Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©:</label>
    <input type="text" id="newCategory" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©">
    <input type="number" id="newRate" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø©">
    <button class="btn" onclick="addCategory()">Ø¥Ø¶Ø§ÙØ©</button>
    <hr>
    <button class="btn" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸</button>
  </div>
</div>

<script>
const table1 = [3, 6, 8, 10, 12];
const table2 = [15, 18, 24, 30, 36];
let interestByCategory = JSON.parse(localStorage.getItem('rates')) || {
  "Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª": 64,
  "Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©": 60,
  "Ø£Ø«Ø§Ø«": 58,
  "Ù…Ù„Ø§Ø¨Ø³": 50
};

function populateCategoryOptions() {
  const select = document.getElementById("category");
  select.innerHTML = '<option value="">Ø§Ø®ØªØ± ÙØ¦Ø©</option>';
  for (const cat in interestByCategory) {
    select.innerHTML += `<option value="${cat}">${cat}</option>`;
  }
}

function calculate() {
  const cat = document.getElementById("category").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const down = parseFloat(document.getElementById("downPayment").value);
  const result = document.getElementById("results");

  if (!cat || isNaN(amount) || isNaN(down) || down > amount) {
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");
    return;
  }

  const rate = (interestByCategory[cat] || 0) / 100;
  const remain = amount - down;
  const createTable = (terms) => {
    let html = `<table><tr><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ±</th><th>Ø§Ù„Ù‚Ø³Ø·</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>`;
    terms.forEach(m => {
      let interest = remain * rate * (m / 12);
      let total = Math.round((remain + interest) / 5) * 5;
      let monthly = Math.round(total / m / 5) * 5;
      html += `<tr><td>${m}</td><td>${monthly} Ø¬Ù…</td><td>${total} Ø¬Ù…</td></tr>`;
    });
    html += `</table>`;
    return html;
  };

  result.innerHTML = `
    <div style="flex:1">${createTable(table1)}</div>
    <div style="flex:1">${createTable(table2)}</div>
  `;
}

function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
}

function openSettings() {
  const modal = document.getElementById("settingsModal");
  const content = document.getElementById("settingsContent");
  content.innerHTML = '';

  for (const cat in interestByCategory) {
    content.innerHTML += `
      <label>${cat} (%):</label>
      <input type="number" id="rate-${cat}" value="${interestByCategory[cat]}"><br>
    `;
  }
  modal.style.display = "flex";
}

function closeSettings() {
  document.getElementById("settingsModal").style.display = "none";
}

function saveSettings() {
  for (const cat in interestByCategory) {
    let input = document.getElementById(`rate-${cat}`);
    interestByCategory[cat] = parseFloat(input.value) || 0;
  }
  localStorage.setItem('rates', JSON.stringify(interestByCategory));
  populateCategoryOptions();
  closeSettings();
}

function addCategory() {
  let name = document.getElementById("newCategory").value.trim();
  let rate = parseFloat(document.getElementById("newRate").value);
  if (name && !isNaN(rate)) {
    interestByCategory[name] = rate;
    localStorage.setItem('rates', JSON.stringify(interestByCategory));
    populateCategoryOptions();
    openSettings();
  }
}

async function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const content = document.getElementById("results").innerHTML;

  doc.setFont("helvetica", "normal");
  doc.html(document.querySelector(".tables"), {
    callback: function (doc) {
      doc.save("ØªÙ‚Ø±ÙŠØ±-Ø§Ù„Ø£Ù‚Ø³Ø§Ø·.pdf");
    },
    x: 10,
    y: 10,
    autoPaging: 'text',
    html2canvas: { scale: 0.5 }
  });
}

window.onload = populateCategoryOptions;
</script>

</body>
</html>